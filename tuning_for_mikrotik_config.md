# Анализ работы WireGuard в MikroTik RouterOS

## Фундаментальные принципы WireGuard в экосистеме RouterOS

В этом разделе рассматриваются ключевые компоненты протокола WireGuard и их интеграция в архитектуру RouterOS. Будут проанализированы основные строительные блоки — интерфейс, криптографическая идентификация и жизненный цикл сессии, — понимание которых необходимо для освоения последующих концепций маршрутизации и устранения неполадок.

### 1.1 Виртуальный интерфейс WireGuard: Нативный компонент ядра

Философия дизайна WireGuard основана на простоте, представляя VPN как стандартный виртуальный сетевой интерфейс (например, wg0). MikroTik полностью следует этому подходу, интегрируя WireGuard непосредственно в RouterOS (начиная с версии 7) как отдельный тип интерфейса, управляемый через меню

```bash
/interface wireguard
```

В отличие от старых реализаций OpenVPN, это не демон пользовательского пространства, а высокопроизводительный компонент, работающий на уровне ядра операционной системы.

При создании нового интерфейса WireGuard в RouterOS автоматически генерируется пара криптографических ключей. Параметр ```private-key``` хранится в секрете на маршрутизаторе, в то время как доступный только для чтения ```public-key``` служит идентификатором маршрутизатора для его пиров. Этот процесс отражает простоту обмена ключами SSH, что является одной из основных целей дизайна WireGuard. Такой подход по умолчанию способствует соблюдению лучших практик безопасности: каждый интерфейс получает уникальную и надежную идентификацию с момента создания. Это избавляет администратора от необходимости использовать внешние утилиты, такие как wg genkey, для генерации ключей самого маршрутизатора.

Ключевые параметры интерфейса включают:

* ```listen-port```: UDP-порт, на котором интерфейс прослушивает входящие рукопожатия и пакеты данных. В RouterOS по умолчанию используется порт 13231 , однако можно использовать любой другой свободный UDP-порт.

* ```mtu```: Максимальный размер передаваемого блока (Maximum Transmission Unit) для туннеля. RouterOS устанавливает значение по умолчанию 1420 байт. Это консервативное значение, учитывающее служебные заголовки WireGuard и нижележащих протоколов IPv4/IPv6, что помогает предотвратить фрагментацию пакетов.

* ```private-key / public-key```: Фундаментальная пара ключей на основе эллиптической кривой Curve25519, которая определяет криптографическую идентичность интерфейса.

### 1.2 Рукопожатие и жизненный цикл сессии: Установление безопасной связи
